"use strict";angular.module("app.controllers").controller("reportsCtrl",["$scope","localDataFactory","$log",function(t,e,n){t.reports={},t.reports.allUnits=e.allUnits,t.reports.inspectionStubs=null,t.reports.visitStubs=null,t.reports.visitData={ready:!1,data:{}},t.reports.fullInspection={data:{}},t.reports.itemsByCondition={data:{}},t.reports.currentInspectionTemplateOptions=e.currentInspectionTemplateOptions,t.reports.newInspectionName="",t.reports.newUnit={},t.reports.createUnit=function(){return t.reports.newUnit.unitTemplate?t.reports.newUnit.name&&""!==t.reports.newUnit.name.trim()?void e.createNewUnit(t.reports.newUnit).then(function(e){return e&&e._id?void alert("Unit name must be unique"):(t.reports.showNewUnit=!1,delete t.reports.newUnit.name,delete t.reports.newUnit.unitTemplate,void 0)}):void alert("Unit name cannot be empty"):void alert("You must select the # of beds/baths")},t.reports.createInspection=function(){return t.reports.newInspectionName&&""!==t.reports.newInspectionName.trim()?void e.createNewInspection(t.reports.selectedUnit,t.reports.newInspectionName).then(function(){t.reports.getInspectionStubs(t.reports.selectedUnit._id),t.reports.showNewInspection=!1,t.reports.newInspectionName=""}):void alert("Inspection name cannot be empty")},t.reports.getInspectionStubs=function(n){t.reports.inspectionStubs={};var o="getInspections/inspection-data-by-unit-id";e.getQueryStubs(n,o).then(function(e){t.reports.inspectionStubs=e})},t.reports.getVisitStubs=function(n){t.reports.fullReportReady=!1,t.reports.visitStubs={};var o="getInspectionVisits/visit-data-by-inspection-id";e.getQueryStubs(n,o).then(function(e){t.reports.visitStubs=e})},t.reports.getVisitData=function(n){t.reports.visitData.ready=!1,t.reports.visitData.data={},e.getVisitData(n).then(function(e){t.reports.visitData.data=angular.toJson(e,!0),t.reports.visitData.ready=!0})},t.reports.getOptionTemplateFromID=function(e,n){for(var o=0;o<t.reports.typesConditions[e].options.length;o++)for(var r=t.reports.typesConditions[e].options[o],i=0;i<r.length;i++){var s=r[i];if(s.optionID===n)return s}},t.reports.getReportInspection=function(o){t.reports.fullReportReady=!1,t.reports.itemsByCondition.data={},e.getInspectionData(o,!0).then(function(){n.info("Finished getting inspection data for full report"),t.reports.selectedPropertyName=e.selectedInspection.propertyName,e.selectedTemplate.inspectionWorkTrackingConditions&&(t.reports.inspectionWorkTrackingConditions=e.selectedTemplate.inspectionWorkTrackingConditions,angular.forEach(e.selectedTemplate.inspectionWorkTrackingConditions.data,function(e,n){t.reports.itemsByCondition.data[n]||(t.reports.itemsByCondition.data[n]=[])})),e.selectedTemplate.typesConditions&&(t.reports.typesConditions=e.selectedTemplate.typesConditions),e.selectedTemplate.trades&&(t.reports.trades=e.selectedTemplate.trades);var o=e.selectedTemplate.checklistVersion;o||(o="v1"),t.reports.checklistVersion=o,t.reports.fullInspection=angular.copy(e.selectedInspection),t.reports.selectedTemplate=e.selectedTemplate,angular.forEach(t.reports.fullInspection.data,function(e,n){angular.forEach(e.data,function(e,o){if(e.inspectionWorkTrackingConditions){var r=e.inspectionWorkTrackingConditions.selection,i={roomKey:n,sectionKey:o,data:e};t.reports.itemsByCondition.data[r].push(i)}})}),n.info("Full report is ready"),t.reports.fullReportReady=!0})}}]);