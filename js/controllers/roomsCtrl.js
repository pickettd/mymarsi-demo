"use strict";angular.module("app.controllers").controller("roomsCtrl",["$scope","$ionicModal","$log","localDataFactory","$stateParams","$state",function(o,m,e,r,s,n){angular.equals(r.selectedVisit,{})&&n.go("home"),o.rooms={},o.rooms.selectedRoomID=s.roomID,o.rooms[s.roomID]={},o.rooms[s.roomID].newComments={},o.rooms[s.roomID].newImages={},o.rooms[s.roomID].newVideos={},o.rooms[s.roomID].modalSection="",o.rooms[s.roomID].checklistVersion="loading",o.rooms[s.roomID].showTips={},o.rooms.inspectionWorkTrackingConditions={},o.rooms.typesConditions={},r.selectedVisit._id?o.rooms.displayTitle=r.selectedVisit._id:o.rooms.displayTitle="",o.rooms.videoError=function(o){e.error(o)},o.rooms.videoConfig={sources:[{}],tracks:[],theme:"lib/videogular-themes-default/videogular.css"},r.getInspectionData(s.inspectionID).then(function(m){o.rooms[s.roomID].selectedPropertyName=m.propertyName,o.rooms.displayTitle=r.selectedVisit._id,m.inspectionWorkTrackingConditions&&(o.rooms.inspectionWorkTrackingConditions=m.inspectionWorkTrackingConditions),m.typesConditions&&(o.rooms.typesConditions=m.typesConditions);var e=m.checklistVersion;e||(e="v1"),o.rooms[s.roomID].checklistVersion=e,angular.forEach(m.data[s.roomID].data,function(m){m.markSectionComplete&&(o.rooms[s.roomID][m._id]=!0);var e='rooms["'+s.roomID+'"].sections["'+m._id+'"]';o.$watch(e,function(o,e){angular.equals(o,e)||(r.selectedInspection.data[s.roomID].data[m._id]=o,r.saveVisitData(s.roomID,m._id,o))},!0)}),o.rooms[s.roomID].sections=m.data[s.roomID].data})["catch"](function(o){e.error(o)});var i=function(m){o.rooms[s.roomID].modalSection=m},t=function(){var m=0;return angular.forEach(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos,function(o){m++}),m};o.rooms[s.roomID].videoFileNameChanged=function(m){var e=m.target;if(o.rooms[s.roomID].videoFilesItemHandle=e,1===e.files.length&&0===e.files[0].type.indexOf("video/")){var r=new FileReader;r.onload=function(m){var e=o.rooms[s.roomID].videoFilesItemHandle.files[0].name,r=o.rooms[s.roomID].videoFilesItemHandle.files[0].type;o.rooms[s.roomID].newVideos||(o.rooms[s.roomID].newVideos={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos={});var n={src:m.target.result,name:e,type:r};o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection].array=[n],o.$apply()},r.readAsDataURL(e.files[0])}},o.rooms[s.roomID].addNewVideo=function(){var m=angular.copy(o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]);o.rooms[s.roomID].newVideos||(o.rooms[s.roomID].newVideos={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos={}),m._id=t()+1,o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos[m._id]=m,o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]={},o.rooms[s.roomID].videoFilesItemHandle.value=""},o.rooms[s.roomID].deleteVideo=function(m){delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos[m],0===t()&&delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos};var a=function(){var m=0;return angular.forEach(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images,function(o){m++}),m};o.rooms[s.roomID].fileNameChanged=function(m){var e=m.target;if(o.rooms[s.roomID].filesItemHandle=e,1===e.files.length&&0===e.files[0].type.indexOf("image/")){var r=new FileReader;r.onload=function(m){var e=o.rooms[s.roomID].filesItemHandle.files[0].name;o.rooms[s.roomID].newImages||(o.rooms[s.roomID].newImages={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images={}),o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection].src=m.target.result,o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection].name=e,o.$apply()},r.readAsDataURL(e.files[0])}},o.rooms[s.roomID].addNewImage=function(){var m=angular.copy(o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]);o.rooms[s.roomID].newImages||(o.rooms[s.roomID].newImages={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images={}),m._id=a()+1,o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images[m._id]=m,o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]={},o.rooms[s.roomID].filesItemHandle.value=""},o.rooms[s.roomID].deleteImage=function(m){delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images[m],0===a()&&delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images};var d=function(){var m=0;return angular.forEach(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments,function(o){m++}),m};o.rooms[s.roomID].deleteComment=function(m){delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments[m],0===d()&&delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments},o.rooms[s.roomID].createComment=function(){var m=angular.copy(o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]);o.rooms[s.roomID].comments||(o.rooms[s.roomID].comments={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments={}),m._id=d()+1,o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments[m._id]=m,o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]={}},m.fromTemplateUrl("templates/modals/manageComments.html",{scope:o,animation:"slide-in-up",focusFirstInput:!0}).then(function(m){o.rooms[s.roomID].commentsModal=m}),o.rooms[s.roomID].openCommentsModal=function(m){i(m),o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]||(o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]={}),o.rooms[s.roomID].commentsModal.show()},o.rooms[s.roomID].closeCommentsModal=function(){o.rooms[s.roomID].commentsModal.hide()},o.$on("$destroy",function(){o.rooms[s.roomID].commentsModal.remove()}),m.fromTemplateUrl("templates/modals/manageVideos.html",{scope:o,animation:"slide-in-up"}).then(function(m){o.rooms[s.roomID].videosModal=m}),o.rooms[s.roomID].openVideosModal=function(m){i(m),o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]||(o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].showDelete=!1,o.rooms[s.roomID].videosModal.show()},o.rooms[s.roomID].closeVideosModal=function(){o.rooms[s.roomID].videosModal.hide()},o.$on("$destroy",function(){o.rooms[s.roomID].videosModal.remove()}),m.fromTemplateUrl("templates/modals/manageImages.html",{scope:o,animation:"slide-in-up"}).then(function(m){o.rooms[s.roomID].imagesModal=m}),o.rooms[s.roomID].openImagesModal=function(m){i(m),o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]||(o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]={}),o.rooms[s.roomID].imagesModal.show()},o.rooms[s.roomID].closeImagesModal=function(){o.rooms[s.roomID].imagesModal.hide()},o.$on("$destroy",function(){o.rooms[s.roomID].imagesModal.remove()})}]);