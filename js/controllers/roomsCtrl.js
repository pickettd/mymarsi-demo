"use strict";angular.module("app.controllers").controller("roomsCtrl",["$scope","$ionicModal","$log","localDataFactory","$stateParams",function(o,m,r,e,s){o.rooms={},o.rooms.selectedRoomID=s.roomID,o.rooms[s.roomID]={},o.rooms[s.roomID].newComments={},o.rooms[s.roomID].newImages={},o.rooms[s.roomID].newVideos={},o.rooms[s.roomID].modalSection="",o.rooms[s.roomID].displayTitle="",o.rooms[s.roomID].checklistVersion="loading",o.rooms[s.roomID].videoError=function(o){r.error(o)},o.rooms[s.roomID].videoConfig={sources:[{}],tracks:[],theme:"lib/videogular-themes-default/videogular.css"},e.getPropertyData(s.propertyID).then(function(m){o.rooms[s.roomID].selectedPropertyName=m.name,o.rooms[s.roomID].displayTitle=m.name+" - "+m.data[s.inspectionID].name;var r=m.data[s.inspectionID].checklistVersion;r||(r="v1"),o.rooms[s.roomID].checklistVersion=r,o.rooms[s.roomID].sections=m.data[s.inspectionID].data[s.roomID].data})["catch"](function(o){r.error(o)})["finally"](function(){var m='rooms["'+s.roomID+'"].sections';o.$watch(m,function(o,m){o!==m&&(e.selectedProperty.data[s.inspectionID].data[s.roomID].data=o,e.saveAllPropertyData())},!0)});var n=function(m){o.rooms[s.roomID].modalSection=m},a=function(){var m=0;return angular.forEach(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos,function(o){m++}),m};o.rooms[s.roomID].videoFileNameChanged=function(m){if(o.rooms[s.roomID].videoFilesItemHandle=m,1===m.files.length&&0===m.files[0].type.indexOf("video/")){var r=new FileReader;r.onload=function(m){var r=o.rooms[s.roomID].videoFilesItemHandle.files[0].name,e=o.rooms[s.roomID].videoFilesItemHandle.files[0].type;o.rooms[s.roomID].newVideos||(o.rooms[s.roomID].newVideos={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos={});var n={src:m.target.result,name:r,type:e};o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection].array=[n],o.$apply()},r.readAsDataURL(m.files[0])}},o.rooms[s.roomID].addNewVideo=function(){var m=angular.copy(o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]);o.rooms[s.roomID].newVideos||(o.rooms[s.roomID].newVideos={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos={}),m._id=a()+1,o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos[m._id]=m,o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]={},o.rooms[s.roomID].videoFilesItemHandle.value=""},o.rooms[s.roomID].deleteVideo=function(m){delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].videos[m]};var t=function(){var m=0;return angular.forEach(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images,function(o){m++}),m};o.rooms[s.roomID].fileNameChanged=function(m){if(o.rooms[s.roomID].filesItemHandle=m,1===m.files.length&&0===m.files[0].type.indexOf("image/")){var r=new FileReader;r.onload=function(m){var r=o.rooms[s.roomID].filesItemHandle.files[0].name;o.rooms[s.roomID].newImages||(o.rooms[s.roomID].newImages={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images={}),o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection].src=m.target.result,o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection].name=r,o.$apply()},r.readAsDataURL(m.files[0])}},o.rooms[s.roomID].addNewImage=function(){var m=angular.copy(o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]);o.rooms[s.roomID].newImages||(o.rooms[s.roomID].newImages={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images={}),m._id=t()+1,o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images[m._id]=m,o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]={},o.rooms[s.roomID].filesItemHandle.value=""},o.rooms[s.roomID].deleteImage=function(m){delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].images[m]};var i=function(){var m=0;return angular.forEach(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments,function(o){m++}),m};o.rooms[s.roomID].deleteComment=function(m){delete o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments[m]},o.rooms[s.roomID].createComment=function(){var m=angular.copy(o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]);o.rooms[s.roomID].comments||(o.rooms[s.roomID].comments={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments||(o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments={}),m._id=i()+1,o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].comments[m._id]=m,o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]={}},m.fromTemplateUrl("templates/modals/manageComments.html",{scope:o,animation:"slide-in-up",focusFirstInput:!0}).then(function(m){o.rooms[s.roomID].commentsModal=m}),o.rooms[s.roomID].openCommentsModal=function(m){n(m),o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]||(o.rooms[s.roomID].newComments[o.rooms[s.roomID].modalSection]={}),o.rooms[s.roomID].commentsModal.show()},o.rooms[s.roomID].closeCommentsModal=function(){o.rooms[s.roomID].commentsModal.hide()},o.$on("$destroy",function(){o.rooms[s.roomID].commentsModal.remove()}),m.fromTemplateUrl("templates/modals/manageVideos.html",{scope:o,animation:"slide-in-up"}).then(function(m){o.rooms[s.roomID].videosModal=m}),o.rooms[s.roomID].openVideosModal=function(m){n(m),o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]||(o.rooms[s.roomID].newVideos[o.rooms[s.roomID].modalSection]={}),o.rooms[s.roomID].sections[o.rooms[s.roomID].modalSection].showDelete=!1,o.rooms[s.roomID].videosModal.show()},o.rooms[s.roomID].closeVideosModal=function(){o.rooms[s.roomID].videosModal.hide()},o.$on("$destroy",function(){o.rooms[s.roomID].videosModal.remove()}),m.fromTemplateUrl("templates/modals/manageImages.html",{scope:o,animation:"slide-in-up"}).then(function(m){o.rooms[s.roomID].imagesModal=m}),o.rooms[s.roomID].openImagesModal=function(m){n(m),o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]||(o.rooms[s.roomID].newImages[o.rooms[s.roomID].modalSection]={}),o.rooms[s.roomID].imagesModal.show()},o.rooms[s.roomID].closeImagesModal=function(){o.rooms[s.roomID].imagesModal.hide()},o.$on("$destroy",function(){o.rooms[s.roomID].imagesModal.remove()})}]);