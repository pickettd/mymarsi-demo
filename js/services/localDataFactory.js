"use strict";angular.module("app.services").factory("localDataFactory",["DemoDataFactory","$pouchDB","$q","$log",function(e,r,t,o){var s={};return s.isReady=!1,s.processingPromise=null,s.selectedPropertyID=null,s.selectedProperty={},r.setDatabase("mymarsi-demo-localonly"),s.getPropertyData=function(c){return c===s.selectedPropertyID?s.isReady?t.when(s.selectedProperty):s.processingPromise.promise:(s.isReady=!1,s.processingPromise=t.defer(),s.selectedProperty={},s.selectedPropertyID=c,r.get({ok:!0,id:c}).then(function(e){o.info("Success getting sections from local db"),s.selectedProperty=e,s.isReady=!0,s.processingPromise.resolve(s.selectedProperty)})["catch"](function(t){404===t.status?(o.info("Section data not found in local database; creating"),s.selectedProperty=e.properties[c],r.save(s.selectedProperty).then(function(){s.isReady=!0,s.processingPromise.resolve(s.selectedProperty)})["catch"](function(e){o.error(e),s.selectedPropertyID=null,s.isReady=!1,s.processingPromise.reject(e)})):(o.error(t),s.selectedPropertyID=null,s.isReady=!1,s.processingPromise.reject(t))}),s.processingPromise.promise)},s.saveAllPropertyData=function(){r.save(s.selectedProperty).then(function(){o.info("Success saving change to db")})["catch"](function(e){409===e.status?r.retryUntilWritten(s.selectedProperty):o.error(e)})},s}]);