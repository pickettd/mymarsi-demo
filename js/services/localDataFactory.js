"use strict";angular.module("app.services").factory("localDataFactory",["DemoDataFactory","$pouchDB","$q","$log",function(e,s,n,t){var c={};return c.isReady=!1,c.processingPromise=null,c.selectedInspectionID=null,c.selectedInspection={},s.setDatabase("mymarsi-demo-localonly-inspections"),c.getInspectionData=function(o){return o===c.selectedInspectionID?c.isReady?n.when(c.selectedInspection):c.processingPromise.promise:(c.isReady=!1,c.processingPromise=n.defer(),c.selectedInspection={},c.selectedInspectionID=o,s.get({ok:!0,id:o}).then(function(e){t.info("Success getting sections from local db"),c.selectedInspection=e,c.isReady=!0,c.processingPromise.resolve(c.selectedInspection)})["catch"](function(n){404===n.status?(t.info("Section data not found in local database; creating"),c.selectedInspection=e.inspections[o],s.save(c.selectedInspection).then(function(){c.isReady=!0,c.processingPromise.resolve(c.selectedInspection)})["catch"](function(e){t.error(e),c.selectedInspectionID=null,c.isReady=!1,c.processingPromise.reject(e)})):(t.error(n),c.selectedInspectionID=null,c.isReady=!1,c.processingPromise.reject(n))}),c.processingPromise.promise)},c.saveAllInspectionData=function(){s.save(c.selectedInspection).then(function(){t.info("Success saving change to db")})["catch"](function(e){409===e.status?s.retryUntilWritten(c.selectedInspection):t.error(e)})},c}]);